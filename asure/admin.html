<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Admin - Registro de Presen√ßa - ASURE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --primary:#1f3a5f;
  --primary-light:#2c5282;
  --bg:#f2f5f9;
  --card:#ffffff;
  --border:#e2e8f0;
  --text:#1a202c;
  --muted:#718096;
  --radius:12px;
}

/* DARK MODE */
body.dark {
  --bg:#0f172a;
  --card:#020617;
  --border:#1e293b;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --primary:#2563eb;
  --primary-light:#3b82f6;
}

body {
  font-family:"Segoe UI", Arial, sans-serif;
  background:var(--bg);
  padding:20px;
  color:var(--text);
}

/* ===== LOGIN ===== */
.login-box {
  max-width:420px;
  margin:80px auto;
  background:var(--card);
  padding:35px 30px;
  border-radius:var(--radius);
  box-shadow:0 15px 35px rgba(0,0,0,0.15);
  border:1px solid var(--border);
}

.login-box h2 { text-align:center; margin-bottom:20px; color:var(--primary); }

.login-box input, .login-box button {
  width:100%;
  padding:12px;
  margin-top:12px;
  border-radius:8px;
  border:1px solid var(--border);
  font-size:14px;
  background:var(--card);
  color:var(--text);
}

.login-box button {
  background:var(--primary);
  color:#fff;
  border:none;
  cursor:pointer;
  font-weight:600;
}

.btn-voltar {
  background:#f1f5f9 !important;
  color:var(--primary) !important;
}

/* ===== SISTEMA ===== */
.hidden { display:none; }
.sistema-container { max-width:1200px; margin:0 auto; }

.header {
  background:var(--card);
  padding:18px 25px;
  border-radius:var(--radius);
  box-shadow:0 8px 20px rgba(0,0,0,0.08);
  border:1px solid var(--border);
  margin-bottom:18px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  flex-wrap:wrap;
  gap:10px;
}

.header h1 { font-size:20px; margin:0; color:var(--primary); }

.header-actions {
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}

.header-actions button {
  padding:8px 12px;
  border-radius:8px;
  border:1px solid var(--border);
  background:var(--card);
  color:var(--text);
  cursor:pointer;
  font-size:13px;
}

.header-actions button.primary {
  background:var(--primary);
  color:#fff;
  border-color:var(--primary);
}

/* Filtros */
.filtros {
  background:var(--card);
  padding:18px;
  border-radius:var(--radius);
  box-shadow:0 6px 15px rgba(0,0,0,0.06);
  border:1px solid var(--border);
  margin-bottom:18px;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:12px;
}

.filtros input {
  padding:10px 12px;
  border-radius:8px;
  border:1px solid var(--border);
  background:var(--card);
  color:var(--text);
}

/* Tabela */
.table-wrapper {
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:0 6px 15px rgba(0,0,0,0.06);
  border:1px solid var(--border);
  overflow:hidden;
}

table { width:100%; border-collapse:collapse; }

th, td {
  padding:12px 14px;
  border-bottom:1px solid var(--border);
  font-size:14px;
}

th {
  background:var(--primary);
  color:#fff;
  cursor:pointer;
}

tbody tr:hover { background:rgba(100,116,139,0.1); }

.assinatura img {
  max-width:80px;
  border:1px solid var(--border);
  border-radius:6px;
  margin-top:4px;
}

.assinatura a {
  display:block;
  font-size:11px;
  color:var(--primary-light);
}

/* Pagina√ß√£o */
.paginacao { margin:18px 0 5px; text-align:center; }

.paginacao button {
  padding:6px 12px;
  margin:3px;
  border-radius:6px;
  border:1px solid var(--border);
  background:var(--card);
  color:var(--text);
  cursor:pointer;
}

.paginacao button[style*="bold"] {
  background:var(--primary);
  color:#fff;
  border-color:var(--primary);
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login" class="login-box">
  <h2>üîê Acesso Administrativo</h2>
  <input type="text" id="loginUser" placeholder="Usu√°rio">
  <input type="password" id="loginPass" placeholder="Senha">
  <button onclick="fazerLogin()">Entrar</button>
  <button type="button" class="btn-voltar" onclick="window.location.href='index.html'">‚¨Ö Voltar</button>
  <p id="loginErro" style="color:#ef4444; display:none; margin-top:10px; font-size:13px;">Usu√°rio ou senha inv√°lidos.</p>
</div>

<!-- SISTEMA -->
<div id="sistema" class="hidden sistema-container">

  <div class="header">
    <h1>üìã Admin - Registro de Presen√ßa - ASURE</h1>
    <div class="header-actions">
      <button onclick="window.location.href='index.html'">‚¨Ö Voltar</button>
      <button onclick="exportarExcel()">üìä Exportar Excel</button>
      <button onclick="exportarPDF()">üñ®Ô∏è Exportar PDF</button>
      <button class="primary" onclick="toggleDarkMode()">üåô Tema</button>
    </div>
  </div>

  <div class="filtros">
    <input type="text" id="filtroNome" placeholder="üîé Filtrar por nome">
    <input type="text" id="filtroUnidade" placeholder="üè´ Filtrar por unidade">
    <input type="date" id="filtroDataInicio">
    <input type="date" id="filtroDataFim">
  </div>

  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th onclick="ordenar('dataHora')">Data/Hora <span id="ord-dataHora"></span></th>
          <th onclick="ordenar('nome')">Nome <span id="ord-nome"></span></th>
          <th onclick="ordenar('unidade')">Unidade <span id="ord-unidade"></span></th>
          <th>Assinatura</th>
        </tr>
      </thead>
      <tbody id="tabelaRegistros"></tbody>
    </table>
  </div>

  <div class="paginacao" id="paginacao"></div>
</div>

<script>
const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbyyZq4OSr76GPhnitpnallY1jok8aqkL70df3Tv-kgTiooiEMMBSqBKuPnFtN9W6_Ys/exec";
const USUARIO = "admin";
const SENHA = "1234";

/* ===== DARK MODE ===== */
function toggleDarkMode() {
  document.body.classList.toggle("dark");
  localStorage.setItem("darkMode", document.body.classList.contains("dark"));
}

if (localStorage.getItem("darkMode") === "true") {
  document.body.classList.add("dark");
}

/* ===== LOGIN ===== */
function fazerLogin() {
  if (loginUser.value === USUARIO && loginPass.value === SENHA) {
    login.classList.add("hidden");
    sistema.classList.remove("hidden");
    carregarDados();
  } else {
    loginErro.style.display = "block";
  }
}

/* ===== SISTEMA ===== */
let registrosOriginais = [];
let registrosFiltrados = [];
let paginaAtual = 1;
const itensPorPagina = 10;
let ordemAtual = { campo:null, asc:true };

function formatarDataHora(iso) {
  return new Date(iso).toLocaleString("pt-BR");
}

function carregarDados() {
  fetch(URL_SCRIPT)
    .then(r => r.json())
    .then(d => { registrosOriginais = d; aplicarFiltros(); })
    .catch(() => alert("Erro ao carregar dados"));
}

function aplicarFiltros() {
  const nome = filtroNome.value.toLowerCase();
  const unidade = filtroUnidade.value.toLowerCase();
  const ini = filtroDataInicio.value;
  const fim = filtroDataFim.value;

  registrosFiltrados = registrosOriginais.filter(r => {
    const d = new Date(r.dataHora);
    let ok = r.nome.toLowerCase().includes(nome) &&
             r.unidade.toLowerCase().includes(unidade);
    if (ini) ok = ok && d >= new Date(ini);
    if (fim) {
      const f = new Date(fim); f.setHours(23,59,59,999);
      ok = ok && d <= f;
    }
    return ok;
  });

  paginaAtual = 1;
  aplicarOrdenacao();
}

function ordenar(campo) {
  ordemAtual.asc = ordemAtual.campo === campo ? !ordemAtual.asc : true;
  ordemAtual.campo = campo;
  aplicarOrdenacao();
}

function aplicarOrdenacao() {
  if (ordemAtual.campo) {
    registrosFiltrados.sort((a,b)=>{
      let v1=a[ordemAtual.campo], v2=b[ordemAtual.campo];
      if (ordemAtual.campo==="dataHora") { v1=new Date(v1); v2=new Date(v2); }
      else { v1=(v1||"").toLowerCase(); v2=(v2||"").toLowerCase(); }
      return v1<v2 ? (ordemAtual.asc?-1:1) : v1>v2 ? (ordemAtual.asc?1:-1) : 0;
    });
  }
  renderizarTabela();
}

function renderizarTabela() {
  tabelaRegistros.innerHTML="";
  const ini=(paginaAtual-1)*itensPorPagina;
  const pagina=registrosFiltrados.slice(ini,ini+itensPorPagina);

  if (!pagina.length) {
    tabelaRegistros.innerHTML="<tr><td colspan='4'>Nenhum registro.</td></tr>";
    paginacao.innerHTML="";
    return;
  }

  pagina.forEach(r=>{
    tabelaRegistros.innerHTML+=`
      <tr>
        <td>${formatarDataHora(r.dataHora)}</td>
        <td>${r.nome}</td>
        <td>${r.unidade}</td>
        <td class="assinatura">
          ${r.assinaturaUrl ? `<a href="${r.assinaturaUrl}" target="_blank">Abrir</a>` : ""}
        </td>
      </tr>`;
  });

  renderizarPaginacao();
}

function renderizarPaginacao() {
  const total = Math.ceil(registrosFiltrados.length/itensPorPagina);
  paginacao.innerHTML="";
  for(let i=1;i<=total;i++){
    const b=document.createElement("button");
    b.textContent=i;
    if(i===paginaAtual) b.style.fontWeight="bold";
    b.onclick=()=>{paginaAtual=i; renderizarTabela();}
    paginacao.appendChild(b);
  }
}

/* ===== EXPORTA√á√ïES ===== */
function exportarExcel() {
  let csv = "Data/Hora;Nome;Unidade\n";
  registrosFiltrados.forEach(r=>{
    csv += `"${formatarDataHora(r.dataHora)}";"${r.nome}";"${r.unidade}"\n`;
  });

  const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "registros_presenca.csv";
  link.click();
}

function exportarPDF() {
  window.print();
}

/* Eventos */
filtroNome.oninput = aplicarFiltros;
filtroUnidade.oninput = aplicarFiltros;
filtroDataInicio.onchange = aplicarFiltros;
filtroDataFim.onchange = aplicarFiltros;
</script>
</body>
</html>


