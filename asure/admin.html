<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Admin - Registro de Presen√ßa - ASURE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --primary:#1f3a5f;
  --primary-light:#2c5282;
  --bg:#f2f5f9;
  --card:#ffffff;
  --border:#e2e8f0;
  --text:#1a202c;
  --muted:#718096;
  --radius:12px;
}

body {
  font-family: "Segoe UI", Arial, sans-serif;
  background:var(--bg);
  padding:20px;
  color:var(--text);
}

/* ===== LOGIN ===== */
.login-box {
  max-width:420px;
  margin:80px auto;
  background:var(--card);
  padding:35px 30px;
  border-radius:var(--radius);
  box-shadow:0 15px 35px rgba(0,0,0,0.15);
  border:1px solid var(--border);
}

.login-box h2 {
  text-align:center;
  margin-bottom:20px;
  color:var(--primary);
}

.login-box input,
.login-box button {
  width:100%;
  padding:12px;
  margin-top:12px;
  border-radius:8px;
  border:1px solid var(--border);
  font-size:14px;
}

.login-box input:focus {
  outline:none;
  border-color:var(--primary-light);
  box-shadow:0 0 0 2px rgba(44,82,130,0.15);
}

.login-box button {
  background:var(--primary);
  color:#fff;
  border:none;
  cursor:pointer;
  font-weight:600;
  transition:background .2s, transform .1s;
}

.login-box button:hover {
  background:var(--primary-light);
  transform:translateY(-1px);
}

/* BOT√ÉO VOLTAR */
.btn-voltar {
  background:#f7fafc !important;
  color:var(--primary) !important;
  border:1px solid var(--border) !important;
}

.btn-voltar:hover {
  background:#edf2f7 !important;
}

/* ===== SISTEMA ===== */
.hidden { display:none; }

.sistema-container {
  max-width:1200px;
  margin:0 auto;
}

/* Cabe√ßalho */
.header {
  background:var(--card);
  padding:18px 25px;
  border-radius:var(--radius);
  box-shadow:0 8px 20px rgba(0,0,0,0.08);
  border:1px solid var(--border);
  margin-bottom:18px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  flex-wrap:wrap;
  gap:10px;
}

.header h1 {
  font-size:20px;
  margin:0;
  color:var(--primary);
}

/* Filtros */
.filtros {
  background:var(--card);
  padding:18px;
  border-radius:var(--radius);
  box-shadow:0 6px 15px rgba(0,0,0,0.06);
  border:1px solid var(--border);
  margin-bottom:18px;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:12px;
}

.filtros input {
  padding:10px 12px;
  border-radius:8px;
  border:1px solid var(--border);
  font-size:14px;
}

.filtros input:focus {
  outline:none;
  border-color:var(--primary-light);
  box-shadow:0 0 0 2px rgba(44,82,130,0.15);
}

/* Tabela */
.table-wrapper {
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:0 6px 15px rgba(0,0,0,0.06);
  border:1px solid var(--border);
  overflow:hidden;
}

table {
  width:100%;
  border-collapse:collapse;
}

th, td {
  padding:12px 14px;
  border-bottom:1px solid var(--border);
  font-size:14px;
  text-align:left;
}

th {
  background:var(--primary);
  color:#fff;
  cursor:pointer;
  position:sticky;
  top:0;
  z-index:1;
}

th span {
  font-size:11px;
  margin-left:6px;
}

tbody tr:hover {
  background:#f7fafc;
}

/* Assinatura */
.assinatura img {
  max-width:80px;
  border:1px solid var(--border);
  border-radius:6px;
  margin-top:4px;
}

.assinatura a {
  display:block;
  font-size:11px;
  color:var(--primary-light);
  text-decoration:none;
}

.assinatura a:hover {
  text-decoration:underline;
}

/* Pagina√ß√£o */
.paginacao {
  margin:18px 0 5px;
  text-align:center;
}

.paginacao button {
  padding:6px 12px;
  margin:3px;
  border-radius:6px;
  border:1px solid var(--border);
  background:#fff;
  cursor:pointer;
  font-size:13px;
  transition:all .15s;
}

.paginacao button:hover {
  background:#edf2f7;
}

.paginacao button[style*="bold"] {
  background:var(--primary);
  color:#fff;
  border-color:var(--primary);
}

/* Responsivo */
@media (max-width:600px) {
  .header h1 { font-size:16px; }
  th, td { font-size:12px; padding:10px; }
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login" class="login-box">
  <h2>üîê Acesso Administrativo</h2>
  <input type="text" id="loginUser" placeholder="Usu√°rio">
  <input type="password" id="loginPass" placeholder="Senha">
  <button onclick="fazerLogin()">Entrar</button>
  <button type="button" class="btn-voltar" onclick="window.location.href='index.html'">
    ‚¨Ö Voltar
  </button>
  <p id="loginErro" style="color:#c53030; display:none; margin-top:10px; font-size:13px;">
    Usu√°rio ou senha inv√°lidos.
  </p>
</div>

<!-- SISTEMA -->
<div id="sistema" class="hidden sistema-container">

  <div class="header">
    <h1>üìã Admin - Registro de Presen√ßa - ASURE</h1>
  </div>

  <div class="filtros">
    <input type="text" id="filtroNome" placeholder="üîé Filtrar por nome">
    <input type="text" id="filtroUnidade" placeholder="üè´ Filtrar por unidade">
    <input type="date" id="filtroDataInicio" title="Data inicial">
    <input type="date" id="filtroDataFim" title="Data final">
  </div>

  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th onclick="ordenar('dataHora')">Data/Hora <span id="ord-dataHora"></span></th>
          <th onclick="ordenar('nome')">Nome <span id="ord-nome"></span></th>
          <th onclick="ordenar('unidade')">Unidade <span id="ord-unidade"></span></th>
          <th>Assinatura</th>
        </tr>
      </thead>
      <tbody id="tabelaRegistros"></tbody>
    </table>
  </div>

  <div class="paginacao" id="paginacao"></div>
</div>

<script>
const URL_SCRIPT = "https://script.google.com/macros/s/AKfycbyyZq4OSr76GPhnitpnallY1jok8aqkL70df3Tv-kgTiooiEMMBSqBKuPnFtN9W6_Ys/exec";

/* ===== LOGIN ===== */
const USUARIO = "admin";
const SENHA = "1234";

function fazerLogin() {
  const u = loginUser.value;
  const p = loginPass.value;

  if (u === USUARIO && p === SENHA) {
    login.classList.add("hidden");
    sistema.classList.remove("hidden");
    carregarDados();
  } else {
    loginErro.style.display = "block";
  }
}

/* ===== SISTEMA ===== */
let registrosOriginais = [];
let registrosFiltrados = [];
let paginaAtual = 1;
const itensPorPagina = 10;
let ordemAtual = { campo: null, asc: true };

function formatarDataHora(iso) {
  const d = new Date(iso);
  return d.toLocaleString("pt-BR");
}

function carregarDados() {
  fetch(URL_SCRIPT)
    .then(r => r.json())
    .then(dados => {
      registrosOriginais = dados;
      aplicarFiltros();
    })
    .catch(() => alert("Erro ao carregar dados"));
}

function aplicarFiltros() {
  const nome = filtroNome.value.toLowerCase();
  const unidade = filtroUnidade.value.toLowerCase();
  const ini = filtroDataInicio.value;
  const fim = filtroDataFim.value;

  registrosFiltrados = registrosOriginais.filter(r => {
    const nomeOk = r.nome.toLowerCase().includes(nome);
    const unidadeOk = r.unidade.toLowerCase().includes(unidade);

    let dataOk = true;
    const d = new Date(r.dataHora);

    if (ini) dataOk = d >= new Date(ini);
    if (fim) {
      const f = new Date(fim);
      f.setHours(23,59,59,999);
      dataOk = dataOk && d <= f;
    }

    return nomeOk && unidadeOk && dataOk;
  });

  paginaAtual = 1;
  aplicarOrdenacao();
}

function ordenar(campo) {
  if (ordemAtual.campo === campo) {
    ordemAtual.asc = !ordemAtual.asc;
  } else {
    ordemAtual = { campo, asc: true };
  }
  aplicarOrdenacao();
}

function aplicarOrdenacao() {
  if (ordemAtual.campo) {
    registrosFiltrados.sort((a,b) => {
      let v1 = a[ordemAtual.campo];
      let v2 = b[ordemAtual.campo];

      if (ordemAtual.campo === "dataHora") {
        v1 = new Date(v1);
        v2 = new Date(v2);
      } else {
        v1 = (v1 || "").toString().toLowerCase();
        v2 = (v2 || "").toString().toLowerCase();
      }

      if (v1 < v2) return ordemAtual.asc ? -1 : 1;
      if (v1 > v2) return ordemAtual.asc ? 1 : -1;
      return 0;
    });
  }

  atualizarIndicadores();
  renderizarTabela();
}

function atualizarIndicadores() {
  ["dataHora","nome","unidade"].forEach(c => {
    const el = document.getElementById("ord-"+c);
    if (!el) return;
    el.textContent = (ordemAtual.campo === c) ? (ordemAtual.asc ? "‚ñ≤" : "‚ñº") : "";
  });
}

function renderizarTabela() {
  const tbody = tabelaRegistros;
  tbody.innerHTML = "";

  const inicio = (paginaAtual - 1) * itensPorPagina;
  const fim = inicio + itensPorPagina;
  const pagina = registrosFiltrados.slice(inicio, fim);

  if (pagina.length === 0) {
    tbody.innerHTML = "<tr><td colspan='4'>Nenhum registro.</td></tr>";
    paginacao.innerHTML = "";
    return;
  }

  pagina.forEach(r => {
    const tr = document.createElement("tr");

    const assinatura = r.assinaturaUrl 
      ? `<a href="${r.assinaturaUrl}" target="_blank">Abrir</a>
         <img src="${r.assinaturaUrl}" onerror="this.style.display='none'">`
      : "";

    tr.innerHTML = `
      <td>${formatarDataHora(r.dataHora)}</td>
      <td>${r.nome}</td>
      <td>${r.unidade}</td>
      <td class="assinatura">${assinatura}</td>
    `;

    tbody.appendChild(tr);
  });

  renderizarPaginacao();
}

function renderizarPaginacao() {
  const totalPaginas = Math.ceil(registrosFiltrados.length / itensPorPagina);
  paginacao.innerHTML = "";

  for (let i = 1; i <= totalPaginas; i++) {
    const btn = document.createElement("button");
    btn.textContent = i;
    if (i === paginaAtual) btn.style.fontWeight = "bold";
    btn.onclick = () => { paginaAtual = i; renderizarTabela(); };
    paginacao.appendChild(btn);
  }
}

/* Eventos */
filtroNome.oninput = aplicarFiltros;
filtroUnidade.oninput = aplicarFiltros;
filtroDataInicio.onchange = aplicarFiltros;
filtroDataFim.onchange = aplicarFiltros;
</script>

</body>
</html>
